<!--  ===================================================== -->
<%if false%>
	<h2>participants</h2>
	
	<div class="add_participants">
		 <%= image_tag('add_participants.png', :size => '60x30', :alt => 'Photo Gallery') %>
	</div>
	
	<% @users.each do |user| %>
	<div class="display block">
		<%= link_to({:controller=>'users', :action =>'show'}, :id=>user.id) do%>
			<%= user.name %><br />
			<%= image_tag user.image_url.to_s, :size => '150x150' %><br />
		<%end%>
		<table>
			<tr>
				<th> kosher?</th>
				<td><%=user.kosher?%></td>
			</tr>
			<tr>
				<th>status</th>
				<td><%=user.coming%></td>
			</tr>
	
		</table>
</div>	

	<%f.fields_for :participations do |fp|%>
		<% fp.hidden_field :user_id %>
		<% fp.hidden_field :_destroy %>
		<%=link_to_function("remove","remove_fields(this)")%>
		
		
		
		
		
		
		<%= #render(:partial => "participations_fields", :locals => {:f => fp})%>
		<!-- the dishes are nested inside participations which ends later -->
		
			<h2>dishes</h2>

			<div class="add_">
				 <%= image_tag('add_dishes.png', :size => '60x30', :alt => 'Photo Gallery') %>
			</div>

			<%fp.fields_for :obligations do |fpo|%> 
				<%= render(:partial => "obligations_fields", :locals => {:f => fpo})%>
			
			
			<!-- remove nedded -->
			<!-- add fields java is needed -->
			<!-- ask to bring is needed -->
			<%end%> <!--fpo end -->
	<%end%> <!-- fp end-->
<%end%> <!-- if flase end -->




	$.post("#",{user_id: user_id},function(){
		 alert(<%=params[:user_id]%>);
		   $("#add_field").append( <% fp.hidden_field :user_id, :value => params[:user_id] %>); 
			})
			
			
			 alert(<%=params[:user_id]%>);

<!--  ===================================================== -->
hello all.
i have done a nested form that addsnested attribuets by javascript , following 
<a href="http://railscasts.com/episodes/197-nested-model-form-part-2>railscasts.</a>

i have a feast. it has many dishes through courses and users through participations.
each users get feast assignments like that :
participations has many dishes through obligations.

 my question is : why does it not save? the feast saves but the nested form parts do not...
 basically i guess it is a problem with strong params somehow, or it sould be in the controller or model. so i pasted them first . i pasted the html generated by the program - only the relevant part at the end so to make the question not too long somehow.
thanks

this is the code:
  
    Class Feast < ActiveRecord::Base

    mount_uploader :image, ImageUploader
  
    
    has_many :participations, dependent: :destroy
    has_many :users, :through => :participations
  
    has_many :courses, dependent: :destroy
    has_many :dishes, :through => :courses
  
        
    accepts_nested_attributes_for :participations,
    :allow_destroy => true
  
    accepts_nested_attributes_for :courses,
    :allow_destroy => true
  

and participations:

    
    class Participation < ActiveRecord::Base
  
      belongs_to :user
      belongs_to :feast
  
      has_many :obligations, dependent: :destroy
      has_many :dishes, :through=> :obligations
      has_many :groceries, :as => :needed 
  
      accepts_nested_attributes_for :obligations,
      :allow_destroy => true
  
     
    end


the program is complicated so in the end i of this question i will post the html created for one participant ,one dish and one assignment(=obligation) just so it is seen that the program works fine.

here are my nested forms - their values are updated and inserted by js.
course fields partial:

    <%= link_to_function "remove","remove_fields_dish(this)", :class => "cl_both" %>	
    <%= f.fields_for(:courses, Course.new, child_index: "new_course", class: "fields") do     
    |fc| %>
	 	<%=fc.hidden_field(:dish_id)%> 
		<%=fc.hidden_field(:_destroy,value: false)%>
    <%end%>

participation fields partial:
 
    <%= link_to_function "remove","remove_fields_dish(this)", :class => "cl_both" %>	
     <%= f.fields_for(:courses, Course.new, child_index: "new_course", class: "fields") do    
    |fc| %>
		<%=fc.hidden_field(:dish_id)%> 
		<%=fc.hidden_field(:_destroy,value: false)%>
    <%end%>

obligation fields partial:
    <%= fp.fields_for(:obligations, Obligation.new, child_index: "new_obli", class:    
     "fields") do |fpo| %>
		<%= fpo.hidden_field(:dish_id) %> 
	   	<%= fpo.hidden_field(:_destroy,value: false) %>
     <%end%>


my controller feasts_controller:

    class FeastsController < ApplicationController

     def list
       @user_feast_m=Feast.joins(participations: :user).where(participations: {manager:    
        true}).to_a
       @user_feast_p=Feast.joins(participations: :user).where(participations: {manager:    
        false}).to_a
     end

      def show
         @feast=feast.find(params[:id])
         @users=@feast.users
         @dishes=(Dish.joins(obligations: {participation: :feast}).where(feast:   
         {id:@feast.id }).to_a + @feast.dishes).compact
      end

      def new
   
        @feast= Feast.new
        @myself = User.find(session[:user_id])
         respond_to do |format| 
          format.html 
          format.js 
        end
      end  

      def create
        @feast = Feast.new(feast_params)
        if @feast.save
        flash[:notice]="the feast has been saved. all participants will get invitations and    
        assignments. hope they answer soon"
        redirect_to(:action=>'list')
        else
          render('new')
        end
     end

      def update
      end

      def edit
        @feast=feast.find(params[:id])
        @users=@feast.users.sort{|user1,user2| user2.manager <=>   
        user1.manager}.sort_by{|user| user.name}    
        @dishes=(Dish.joins(obligations: {participation: :feast}).where(feast:   
        {id:@feast.id }).to_a + @feast.dishes).compact
      end

      def delete
         @feast=Feast.find(params[:id])
      end
  
      def destroy
      end 


    private 

       def feast_params
           params.require(:feast).permit(:id, :name, :image, :feast_place,    
           :feast_time,courses_attributes: [:id, 
           :dish_id,:_destroy,:feast_id],participations_attributes: [:id,:feast_id, 
           :user_id, :_destroy],obligations_attributes: [:id, :dish_id, :_destroy, 
           :participation_id])
       end
     
     end

this is the html generated:

     <form accept-charset="UTF-8" action="/feasts/create" enctype="multipart/form-data"     
       method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8"    
     type="hidden" value="âœ“"><input name="authenticity_token" type="hidden" 
     value="llJ73mQ6yIZHKvs1EDHnVbjc1nIGlWN2eCirXwiCgCs="></div>

     #+> some input fields for the feast goes here
    <br><br>
		<label for="feast_feast place">feast_place</label><br><br>
		<input id="feast_feast_place" name="feast[feast_place]" type="text"> <br><br>
		upload image file <br><br>
		<input id="feast_image" name="feast[image]" type="file"> <br><br>
		
    <h2>participants
	
	   <u>
		    <a class="right" data-content="<br />
             <a class="cl_both" href="#"   
             onclick="remove_fields(this); return false;">remove</a>	

		<input id="feast_participations_user_id" name=";feast[participations][user_id]"   
        type="hidden" /> 
		<input id="feast_participations__destroy" name="feast[participations][_destroy]" 
        type="hidden" value="false" />
		<div data-obcontent='


		<input id="feast_participations_obligations_attributes_new_obli_dish_id" 
        name="feast[participations][obligations_attributes][new_obli][dish_id]"   
        type="hidden"/> 
		<input id="feast_participations_obligations_attributes_new_obli__destroy" 
        name="feast[participations][obligations_attributes][new_obli][_destroy]" 
        type="hidden" value="false" />





	' >
			
		</div>
		
					
	
  	" href="#" id="try" onclick="add_par(); return false;">
		 <img alt="Photo Gallery" height="100" src="/assets/add_participants.png"   
      width="100">

     </a>    </u>
      </h2>	

     <br><br><br>	 

	<div data-myid="3" data-myimage=""image":{"url:"/uploads/user/image/3/el4.jp"}}" data-   
     myname="elad bezalel" id="par">
		<table>
			<tbody><tr>
				<th>participant</th>
				<th>assignment</th>
			</tr>
			<tr><td><div class="user_block ui-droppable" style=""><a href="/users/show?  
                      id=7" id="1404733550784"><img alt="user picture" 
                      src="/uploads/user/image/7/Yemenite.gif" height="100" width="100">
                    <br>amit</a><br>
                    <a class="cl_both" href="#" onclick="remove_fields(this); return 
                    false;">remove</a>	

             		<input id="1404733550977" name="feast[participations][user_id]" 
                     type="hidden" value="7"> 
		


             		<input id="1404733554049" name="feast[participations]
                    [obligations_attributes][1404733554050][dish_id]" type="hidden" 
                     value="140473354199"> 
               
   		<input id= "feast_participations_obligations_attributes_1404733554050__destroy"   
         name="feast[participations][obligations_attributes][1404733554050][_destroy]" 
         type="hidden" value="false">





 
 
         	<input id="feast_participations__destroy" name="feast[participations]
            [_destroy]" type="hidden" value="false">
     		<div data-obcontent="


	     	<input id="feast_participations_obligations_attributes_new_obli_dish_id"    
             name="feast[participations][obligations_attributes][new_obli][dish_id]"  
             type="hidden" ></div> 
     		<input id="feast_participations_obligations_attributes_new_obli__destroy"   
            name="feast[participations][obligations_attributes][new_obli][_destroy]"  
            type="hidden" value="false" />





      	">
			
		</div>
		
					
	
     	</div></td><td><dfn>e&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</dfn><img   
        alt="cancel - x" class="x-pic" height="30" src="/assets/x-blue.png" width="30"> 
        </td></tr></tbody></table>
		
		
		
		
      </div>
       <br><br><br><br><br><br>

     <h2>dishes
     	<u>
	    	 <a class="right" data-content="<br />
       <a class="cl_both" href='#' onclick='remove_fields_dish(this); return    
       false'>remove</a>	

		<input id="feast_courses_dish_id" name="feast[courses][dish_id]" type="hidden" /> 
		<input id="feast_courses__destroy" name="feast[courses][_destroy]"type="hidden"   
      value="false" />
	
	" href="#" id="add_course" onclick="add_course(); return false;">
		 <img alt="Photo Gallery" height="100" src="/assets/add_dish.png" width="100">
      </a>    </u>
      </h2>	

      <br><br><br>	 

    	<div id="course">
     	 	<table>

          		<tbody><tr><td><div class="dish_block ui-draggable ui-draggable-handle"    
         style="position: relative; top: 0px; left: 0px;"><a href="/dishes/show?id=9"   
         id="1404733541991"><img alt="dish picture"   
        src="/uploads/dish/image/9/IMG_0012.JPG" height="100" width="100"><br>e</a><br>
  
       <a class="cl_both" href="#" onclick="remove_fields_dish(this); return   
       false;">remove</a>	

		<input id="1404733542182" name="feast[courses][dish_id]" type="hidden" value="9"> 
		<input id="feast_courses__destroy" name="feast[courses][_destroy]" type="hidden"   
       value="false">
	
  	</div></td></tr></tbody></table>		
	</div>	
     <br><br>
	 <input name="commit" type="submit" value="initiate feast">
     </form>


why does the nested parts not save?
<!--  ===================================================== -->